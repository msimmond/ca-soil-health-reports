```{r}
# If the report fails to render at the `create-measurement-group-sections` chunk
# in `01_producer-report.qmd`, run all chunks above to load the data in your
# environment. Then uncomment this group assignment and run each code chunk in
# this file interactively to troubleshoot.
# 
#  group <- "Physical"
#  group <- "Carbon"
#  group <- "Chemical"
#  group <- "Biological"
```

```{r}
#| echo: false
#| output: asis
# Section header
cat(glue::glue("### {group}\n"))
```

```{r}
#| echo: false
#| fig-align: left
#| out-width: "50px"
# Icon (let knitr manage it - works for both HTML and DOCX)
# Convert group to lowercase to match filename case (Linux/ShinyApps.io is case-sensitive)
icon_path <- file.path(app_root, "images", paste0(tolower(group), ".png"))
knitr::include_graphics(icon_path)
```

```{r}
# Include texture triangle for physical group
tt_path <- "figure-output/texture-triangle.png"
if (group == "Physical" & fs::file_exists(tt_path)) {
  texture_triangle <- glue::glue("![]({tt_path}){{width='6in'}}")
}
```

```{r}
#| output: asis
# Include page break after texture triangle
if (group == "Physical" & fs::file_exists(tt_path)) {
  cat(texture_triangle)
  cat("\n")
  cat("{{< pagebreak >}}")
}
```

```{r}
# Print the table
table_list |>
  purrr::pluck(group)
```

\newline

::: {.content-visible when-format="html"}
```{r}
# If HTML, convert the strip plot to interactive ggiraph
if (out_type == "html") {
  tryCatch({
    plot_list |>
      purrr::pluck(group) |>
convert_ggiraph(
        plot,
        plot_name = group,
        body_font = body_font
      )
  }, error = function(e) {
    # If interactive plot fails, show static plot instead
    cat("Interactive plot failed, showing static version:\n")
    plot_list |>
      purrr::pluck(group)
  })
}
```
:::

::: {.content-visible unless-format="html"}
```{r}
# If not HTML, just print the plot
plot_list |>
  purrr::pluck(group)
```
:::

<!-- {{< pagebreak >}} -->
